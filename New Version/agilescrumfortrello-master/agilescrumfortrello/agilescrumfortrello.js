var AST=AST||{};!function(r){"use strict";$(r).ready(function(){AST=function(r){var n="Agile SCRUM for Trello boards",t="1.4.6",e=/\([0-9\.]{1,6}\/[0-9\.]{1,6}\)/,c=/\([0-9\.]{1,6}\//,s=/\/[0-9\.]{1,6}\)/,a=/[0-9]{1,6}\//,i=/\/[0-9]{1,6}/,l=/\([0-9\.]{1,5}\)/,o=/[0-9\.]+/,d=/\[([\u3400-\uFAFF\u3040-\u30ff\uff65-\uffdca-zA-ZæÆåáãàâäéèẽêëíìĩîïøóòõôöúùũûüçÅÁÃÀÂÄÉÈẼÊËÍÌĨÎÏØÓÒÕÔÖÚÙŨÛÜÇ0-9 \_\-\.\#]*)\]/g,u=/>\*{3} .+ \*{3}$/i,f=/c\/([^/]+)\/.+/g,m=1,h=!1,p=0,g="",b=!1,v=5e3,T=0,w=!1,M=0,A=0,L=!1,y=0,H=0,k=!1,C=0,F=0,x=0,S=!1,j=!1,U=!1,_=!1,z=0,I=0,D=0;r.init=function(){console.info(n+" v"+t+" started"),O(),Z()};var O=function(){var r=null,n=null;Z(),$(".window-wrapper").bind("DOMSubtreeModified",function(){window.location.href.match(f)&&!n?(r=f.exec(window.location.href)[1],f.lastIndex=0,n=!0):!window.location.href.match(f)&&n&&(n=!1,Z())}),b=setInterval(function(){R()},v)},R=function(){var r=$("#board").html().length;T!==r&&(T=r,Z())},Z=function(){h=$("#classic-body").css("background-color")&&!$("#classic-body").hasClass("body-custom-board-background")?$("#classic-body").css("background-color"):"rgb(55, 158, 90)",q(),$("#board").find(".list-cards").each(function(){w=$(this),w.find(".list-card").each(function(){return k=$(this),B(k)?-2:k.is(":hidden")?-2:($(k).find(".list-card-title").html().match(/<small /g)?(S=k.data("original"),$(k).find(".list-card-title").html(S)):(S=$(k).find(".list-card-title").html(),k.data("original",S)),E(S)?(H>0&&J(),L=k,L[0].innerHTML=L[0].innerHTML.replace(/( ?\*\*\* ?)/g,""),L.addClass("scrum-card-header")):S.match(e)?(j=S.match(e)[0],C=K(j.match(c)[0]),F=K(j.match(s)[0])):S.match(l)&&(F=K(S.match(l)[0])),U=k.find(".js-checkitems-badge"),F>=C&&G(U)&&(_=U.find(".js-checkitems-badge-text")[0].innerHTML,z=K(_.match(a)[0]),D=K(_.match(i)[0]),x=F-C,I=x/D,C+=I*z),g=C==F?" perfect":C>F?" overrun":"",k[0].innerHTML=k[0].innerHTML.replace(l,P),k[0].innerHTML=k[0].innerHTML.replace(e,P),k[0].innerHTML=k[0].innerHTML.replace(d,N),F>0&&(p=C/F*100,k.prepend('<div class="scrum-card-progress'+g+'" style="background-color:'+h+";width:"+(100>=p?p:100)+'%"></div>'),$(k[0]).css("font-size",(8>F?90+5*F:130)+"%").css("line-height","1.2em")),M+=C,A+=F,L&&(y+=C,H+=F),k=!1,S=j="",void(F=C=0))}),H>0&&J(),w.parent().prepend('<small class="scrum-list-total'+g+'"><span class="scrum-light">'+M.toFixed(m)+"/</span>"+A.toFixed(m)+"</small>"),A>0&&(p=M/A*100,w.parent(".list").prepend('<div class="scrum-list-progress"  style="background-color:'+h+";width:"+(100>=p?p:100)+'%"></div>')),w=!1,M=A=0})},q=function(){$(".scrum-list-total,.scrum-list-progress,.scrum-card-progress").remove()},B=function(){return k.hasClass("js-composer")},E=function(r){return r.match(u)},G=function(r){return 1===r.length},J=function(){$(L.find(".list-card-title")[0]).prepend('<small class="scrum-card-points'+(y>H?" overrun":"")+'"><span class="scrum-light">'+y.toFixed(m)+"/</span>"+H.toFixed(m)+"</small>"),y=H=0},K=function(r){return parseFloat(r.match(o)[0])},N=function(r){var n=r.split("__"),t=Q(n[0]);return"undefined"!=typeof n[1]&&(t=n[1]),'<small class="scrum-card-project" style="background:'+t.replace(/\[|\]/g,"")+'">'+n[0].replace(/\[|\]/g,"").toUpperCase()+"</small>"},P=function(r){return'<small class="scrum-card-points'+g+'">'+r.replace(/\(|\)/g,"").toUpperCase()+"</small>"},Q=function(r){var n=0,t=0,e=r.length;for(r=r.toLowerCase();e>t;t++)n+=900*r.charAt(t).charCodeAt();return"hsla("+n%256+",50%,40%,1)"};return r}(AST||{}),AST.init()})}(document);
